<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序 | TFTFTFTFTF</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="shortcut icon" type="image/x-icon" href="/StudyDocs/favicon.ico">
    <meta name="description" content="TF研究院">
    
    <link rel="preload" href="/StudyDocs/assets/css/0.styles.04c6a6dd.css" as="style"><link rel="preload" href="/StudyDocs/assets/js/app.f0167722.js" as="script"><link rel="preload" href="/StudyDocs/assets/js/2.90e59682.js" as="script"><link rel="preload" href="/StudyDocs/assets/js/9.3a5bd12d.js" as="script"><link rel="prefetch" href="/StudyDocs/assets/js/10.460faf1a.js"><link rel="prefetch" href="/StudyDocs/assets/js/11.8be0c57d.js"><link rel="prefetch" href="/StudyDocs/assets/js/12.84e242a4.js"><link rel="prefetch" href="/StudyDocs/assets/js/3.1cc01215.js"><link rel="prefetch" href="/StudyDocs/assets/js/4.865692a8.js"><link rel="prefetch" href="/StudyDocs/assets/js/5.81254301.js"><link rel="prefetch" href="/StudyDocs/assets/js/6.6e8c67be.js"><link rel="prefetch" href="/StudyDocs/assets/js/7.00b37f6e.js"><link rel="prefetch" href="/StudyDocs/assets/js/8.feb775be.js">
    <link rel="stylesheet" href="/StudyDocs/assets/css/0.styles.04c6a6dd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/StudyDocs/" class="home-link router-link-active"><!----> <span class="site-name">TFTFTFTFTF</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/StudyDocs/javascript/01_创建工具包项目.html" class="sidebar-link">认识 JavaScript</a></li><li><a href="/StudyDocs/javascript/02_开始.html" class="sidebar-link">开始学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/StudyDocs/node/01_函数相关.html" class="sidebar-link">认识 Node</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>C语言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/StudyDocs/CLang/01_开始.html" class="sidebar-link">认识 C语言</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微信小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/StudyDocs/WxMiniapp/01.html" aria-current="page" class="active sidebar-link">小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyDocs/WxMiniapp/01.html#自定义的好物集发券组件-v1-0" class="sidebar-link">自定义的好物集发券组件 v1.0</a></li><li class="sidebar-sub-header"><a href="/StudyDocs/WxMiniapp/01.html#h5打开小程序-注" class="sidebar-link">H5打开小程序 [^注]</a></li><li class="sidebar-sub-header"><a href="/StudyDocs/WxMiniapp/01.html#h5获取用户open-id-注" class="sidebar-link">H5获取用户open_id[^注]</a></li><li class="sidebar-sub-header"><a href="/StudyDocs/WxMiniapp/01.html#h5发券" class="sidebar-link">H5发券</a></li><li class="sidebar-sub-header"><a href="/StudyDocs/WxMiniapp/01.html#查看微信卡包中的券详情" class="sidebar-link">查看微信卡包中的券详情</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="小程序"><a href="#小程序" class="header-anchor">#</a> 小程序</h1> <h2 id="自定义的好物集发券组件-v1-0"><a href="#自定义的好物集发券组件-v1-0" class="header-anchor">#</a> 自定义的好物集发券组件 v1.0</h2> <h4 id="_1-在小程序app-json加入插件配置-引入插件包"><a href="#_1-在小程序app-json加入插件配置-引入插件包" class="header-anchor">#</a> 1. 在小程序app.json加入插件配置(引入插件包)</h4> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;plugins&quot;: {
    &quot;sendCoupon&quot;: {
      &quot;version&quot;: &quot;1.1.5&quot;, // 插件版本号
      &quot;provider&quot;: &quot;wxf3f436ba9bd4be7b&quot;
    }
  }
}
</code></pre></div><h4 id="_2-在小程序页面引入发券插件-仅用于发起请求-样式可定制"><a href="#_2-在小程序页面引入发券插件-仅用于发起请求-样式可定制" class="header-anchor">#</a> 2. 在小程序页面引入发券插件(仅用于发起请求, 样式可定制)</h4> <ul><li>页面json文件(xxx.json)中<div class="language- extra-class"><pre class="language-text"><code>{
  &quot;usingComponents&quot;: {
    &quot;send-coupon&quot;: &quot;plugin://sendaCoupon/send-coupon&quot;
  }
}
</code></pre></div></li> <li>页面wxml文件(xxx.wxml)中<div class="language- extra-class"><pre class="language-text"><code>&lt;send-coupon
  bindcustomevent=&quot;_getcoupon&quot; 
  send_coupon_params=&quot;{{send_coupon_params}}&quot;
  sign=&quot;{{sign}}&quot;
  send_coupon_merchant=&quot;{{send_coupon_merchant}}&quot;
&gt;
  &lt;view&gt;此处可自定义代码&lt;/view&gt;
&lt;/send-coupon&gt;
</code></pre></div></li></ul> <h5 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h5> <ul><li><p>bindcustomevent : 组件的自定义事件, 领券后调用 ==&gt; Function</p></li> <li><p>send_coupon_params : 发券参数 ==&gt; Array[Object]</p> <div class="language- extra-class"><pre class="language-text"><code>[
  {
    stock_id: &quot;string&quot;,
    out_request_no: &quot;string&quot;,
    coupon_code: &quot;string&quot;
  }
]
</code></pre></div><table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">变量</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">必填?</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">批次号</td> <td style="text-align:left;">stock_id</td> <td style="text-align:center;">string</td> <td style="text-align:center;">Y</td> <td style="text-align:left;">券的批次id</td></tr> <tr><td style="text-align:left;">发券凭证</td> <td style="text-align:left;">out_request_no</td> <td style="text-align:center;">string</td> <td style="text-align:center;">Y</td> <td style="text-align:left;">发券凭证</td></tr> <tr><td style="text-align:left;">券code</td> <td style="text-align:left;">coupon_code</td> <td style="text-align:center;">string</td> <td style="text-align:center;">N</td> <td style="text-align:left;">券code, 如果批次是发放时指定code的类型，则发券时必填coupon_code</td></tr></tbody></table></li> <li><p>sign : 签名(<strong>必需</strong>)(需在服务端使用加密算法获得, 详见文档) ==&gt; String</p></li> <li><p>send_coupon_merchant : 发券商户号(<strong>必需</strong>) ==&gt; String</p></li></ul> <h5 id="页面js文件-xxx-js-中-查看参数详情"><a href="#页面js文件-xxx-js-中-查看参数详情" class="header-anchor">#</a> 页面js文件(xxx.js)中 <a href="https://pay.weixin.qq.com/wiki/doc/apiv3/wxpay/marketing/miniprogram/chapter3_1.shtml#top" target="_blank" rel="noopener noreferrer">查看参数详情<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <div class="language- extra-class"><pre class="language-text"><code>_getcoupon(params) {
  console.log('发券插件参数', params);
  if (params.detail.errcode === &quot;OK&quot;) {
    const result = params.detail.send_coupon_result;
  }
}
</code></pre></div><hr> <hr> <hr> <h2 id="h5打开小程序-注"><a href="#h5打开小程序-注" class="header-anchor">#</a> H5打开小程序 <a href="%E5%BF%85%E9%A1%BB%E5%9C%A8%E5%BE%AE%E4%BF%A1%E7%8E%AF%E5%A2%83%E4%B8%AD(%E5%BE%AE%E4%BF%A1%E5%86%85%E7%BD%AE%E6%B5%8F%E8%A7%88%E5%99%A8)">^注</a></h2> <h4 id="_1-开放标签详情-查看文档"><a href="#_1-开放标签详情-查看文档" class="header-anchor">#</a> 1. 开放标签详情 <a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html" target="_blank" rel="noopener noreferrer">查看文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <ul><li><p>在微信公众平台添加&quot;JS接口安全域名&quot;(云开发不需要)</p></li> <li><p>在需要调js接口的文件中引入js文件 <a href="http://res2.wx.qq.com/open/js/jweixin-1.6.0.js" target="_blank" rel="noopener noreferrer">开放标签js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>签名需在服务端进行, 将config中配置项返回前端 <a href="https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=4_3" target="_blank" rel="noopener noreferrer">签名算法(附录1)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>index.html</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;wx-open-launch-weapp
  id=&quot;launch-btn&quot;
  username=&quot;gh_xxxxxxxx&quot;
  path=&quot;pages/home/index.html?user=123&amp;action=abc&quot;
&gt;
  &lt;template&gt;
    &lt;button class=&quot;btn&quot;&gt;打开小程序&lt;/button&gt;
  &lt;/template&gt;
&lt;/wx-open-launch-weapp&gt;

参数: username 必填, 小程序的原始id, 即gh_开头的id
      path    非必填, 所需跳转的小程序内页面路径及参数
</code></pre></div><ul><li>index.js</li></ul> <div class="language- extra-class"><pre class="language-text"><code>wx.config({
  debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印
  appId: '', // 必填，公众号的唯一标识
  timestamp: , // 必填，生成签名的时间戳
  nonceStr: '', // 必填，生成签名的随机串
  signature: '',// 必填，签名
  jsApiList: [], // 必填，需要使用的JS接口列表
  openTagList: [] // 可选，需要使用的开放标签列表，例如['wx-open-launch-app']
});

wx.ready(() =&gt; console.log('config信息验证完成, 可进行非用户触发的接口调用'))
wx.error(err =&gt; console.log('config信息验证失败(可在此处更新签名)'))
</code></pre></div></li></ul> <h4 id="_2-在vue中使用开放标签"><a href="#_2-在vue中使用开放标签" class="header-anchor">#</a> 2. 在Vue中使用开放标签</h4> <ul><li>标签需在配置成功后动态渲染, 否则失效
<ul><li>html中</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;div v-html=&quot;wxBtnDom&quot;&gt;&lt;/div&gt;
</code></pre></div><ul><li>js</li></ul> <div class="language- extra-class"><pre class="language-text"><code>wx.ready(function() {
  this.wxBtnDom = `
    &lt;wx-open-launch-weapp username=&quot;xxx&quot;&gt;
      &lt;script type=&quot;text/wxtag-template&quot;&gt;
        &lt;div 
          style=&quot;display: block; 
            width: ${screen.availWidth - 40}px; 
            height: 280px; 
            border-radius: 10px;
            background: pink;&quot;
        &gt;
        script标签里的内容与外界完全隔离, 样式需写行内
        &lt;/div&gt;
      &lt;script&gt;
    &lt;/wx-open-launch-weapp&gt;
  `
})
</code></pre></div></li></ul> <hr> <hr> <hr> <h2 id="h5获取用户open-id-注"><a href="#h5获取用户open-id-注" class="header-anchor">#</a> H5获取用户open_id<a href="%E5%BF%85%E9%A1%BB%E5%9C%A8%E5%BE%AE%E4%BF%A1%E7%8E%AF%E5%A2%83%E4%B8%AD(%E5%BE%AE%E4%BF%A1%E5%86%85%E7%BD%AE%E6%B5%8F%E8%A7%88%E5%99%A8)">^注</a></h2> <h4 id="_1-open-id是用户在当前公众号下唯一标识"><a href="#_1-open-id是用户在当前公众号下唯一标识" class="header-anchor">#</a> 1. open_id是用户在当前公众号下唯一标识</h4> <h4 id="_2-获取open-id需获得用户授权"><a href="#_2-获取open-id需获得用户授权" class="header-anchor">#</a> 2. 获取open_id需获得用户授权</h4> <ul><li>静默授权 无需用户手动, 会刷新原页面, 仅得到open_id</li> <li>非静默授权 用户手动授权, 可获得更多用户信息(如头像...)</li></ul> <h4 id="_3-获取方法-静默授权"><a href="#_3-获取方法-静默授权" class="header-anchor">#</a> 3. 获取方法(静默授权)</h4> <ul><li>微信公众号后台设置网页授权域名(不带http://和https://)</li> <li>访问微信url, 配置授权方式及回调url(url需转码)</li> <li>获取code的微信url (<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html" target="_blank" rel="noopener noreferrer">文档说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>):</li></ul> <div class="language- extra-class"><pre class="language-text"><code>https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=URL&amp;response_type=code&amp;scope=snsapi_base&amp;state=123#wechat_redirect

注: 该url会自动重定向到转码后的url地址, 并在地址中携带code参数
</code></pre></div><ul><li>url转码
<ul><li>转码方法</li></ul> <div class="language- extra-class"><pre class="language-text"><code>function urlencode(str) {
  str = (str + '').toString(); 
  return encodeURIComponent(str)
    .replace(/!/g, '%21')
    .replace(/'/g, '%27')
    .replace(/\(/g, '%28')
    .replace(/\)/g, '%29')
    .replace(/\*/g, '%2A')
    .replace(/%20/g, '+');
}
</code></pre></div><ul><li>转码地址: http://tool.chinaz.com/tools/urlencode.aspx</li></ul></li></ul> <h4 id="_4-将code传输给服务端以获取open-id"><a href="#_4-将code传输给服务端以获取open-id" class="header-anchor">#</a> 4. 将code传输给服务端以获取open_id</h4> <div class="language- extra-class"><pre class="language-text"><code>服务端调用该接口获得用户信息
https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code

返回参数
{
  &quot;access_token&quot;:&quot;ACCESS_TOKEN&quot;,
  &quot;expires_in&quot;:7200,
  &quot;refresh_token&quot;:&quot;REFRESH_TOKEN&quot;,
  &quot;openid&quot;:&quot;OPENID&quot;,
  &quot;scope&quot;:&quot;SCOPE&quot; 
}
</code></pre></div><h4 id="_5-注意事项"><a href="#_5-注意事项" class="header-anchor">#</a> 5. 注意事项</h4> <ul><li>必须在微信环境中(微信内置浏览器)</li> <li>检测url中是否存在code, 有则下一步, 否则页面将一直重复刷新获取code</li> <li>code是一次性的, 通过该code获得open_id后, code失效</li></ul> <h4 id="_6-附"><a href="#_6-附" class="header-anchor">#</a> 6. 附</h4> <ul><li>判断是否为微信环境</li></ul> <div class="language- extra-class"><pre class="language-text"><code>if (isWeiXin()) {
  console.log('当前是微信环境');
  if (url.indexOf('code') &gt; 0) {
    // 从url中提取code
    const code = getQueryString('code');
    // 获取open_id的方法
    getOpenId(code);
  } else {
    // 没有获取到code, 重新获取
    getBaseInfo();
  }
} else {
  console.log('当前非微信环境');
}

// 是否为微信环境
function isWeiXin() {
  let ua = window.navigator.userAgent.toLowerCase();
  if (ua.match(/MicroMessenger/i) == 'micromessenger') {
    return true
  }
}

// 获取code
function getBaseInfo() {
  const url = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${APPID}&amp;redirect_uri=${URL}&amp;response_type=code&amp;scope=snsapi_base&amp;state=${url_params}#wechat_redirect`;

  window.location.href = url;
}

// 从url中获取参数
function getQueryString(name) {
  let reg = new RegExp(&quot;(^|&amp;)&quot; + name + &quot;=([^&amp;]*)(&amp;|$)&quot;, &quot;i&quot;);
  let r = window.location.search.substr(1).match(reg);
  if (r != null) return unescape(r[2]);
  return null;
}
</code></pre></div><hr> <hr> <hr> <h2 id="h5发券"><a href="#h5发券" class="header-anchor">#</a> H5发券</h2> <h4 id="一-url重定向到指定的微信支付h5页面"><a href="#一-url重定向到指定的微信支付h5页面" class="header-anchor">#</a> 一. URL重定向到指定的微信支付H5页面</h4> <ul><li>重定向地址(每一个H5领券域名后，都需添加#wechat_redirect，否则会报错)</li></ul> <div class="language- extra-class"><pre class="language-text"><code>url: `https://action.weixin.qq.com/busifavor/getcouponinfo?stock_id=${stock_id}&amp;out_request_no=${out_request_no}&amp;send_coupon_merchant=${send_coupon_merchant}&amp;open_id=${open_id}#wechat_redirect`

method: GET
params: 见下表
</code></pre></div><h4 id="二-参数"><a href="#二-参数" class="header-anchor">#</a> 二. 参数</h4> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">变量名</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">必须?</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">批次号</td> <td style="text-align:left;">stock_id</td> <td style="text-align:center;">string</td> <td style="text-align:center;">Y</td> <td style="text-align:left;">券的唯一id</td></tr> <tr><td style="text-align:left;">发券凭证</td> <td style="text-align:left;">out_request_no</td> <td style="text-align:center;">string</td> <td style="text-align:center;">Y</td> <td style="text-align:left;">发券凭证</td></tr> <tr><td style="text-align:left;">发券商户号</td> <td style="text-align:left;">send_coupon_merchant</td> <td style="text-align:center;">string</td> <td style="text-align:center;">Y</td> <td style="text-align:left;">调用发券接口的商户号</td></tr> <tr><td style="text-align:left;">用户openid</td> <td style="text-align:left;">open_id</td> <td style="text-align:center;">string</td> <td style="text-align:center;">Y</td> <td style="text-align:left;">目标发券的用户openid</td></tr></tbody></table> <h4 id="三-签名计算规则"><a href="#三-签名计算规则" class="header-anchor">#</a> 三. 签名计算规则</h4> <ul><li>签名方式 : HMAC-SHA256</li> <li>V2 <a href="https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=4_3" target="_blank" rel="noopener noreferrer">签名规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>签名原串示例</li></ul> <div class="language- extra-class"><pre class="language-text"><code>coupon_code=12345678&amp;open_id=a1B2c3D4&amp;out_request_no=202011181058&amp;send_coupon_merchant=12345678&amp;stock_id=12111100000001&amp;key=1a2B3c4D5e6F
</code></pre></div><h4 id="四-结果"><a href="#四-结果" class="header-anchor">#</a> 四. 结果</h4> <ul><li>1.服务端调用<a href="https://pay.weixin.qq.com/wiki/doc/apiv3/wxpay/marketing/busifavor/chapter3_4.shtml" target="_blank" rel="noopener noreferrer">接口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>根据条件查询用户持有的n(n&gt;=1)张券</li> <li>2.服务端调用<a href="https://pay.weixin.qq.com/wiki/doc/apiv3/wxpay/marketing/busifavor/chapter3_5.shtml" target="_blank" rel="noopener noreferrer">接口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>查询用户持有的某一张券信息</li></ul> <hr> <hr> <hr> <h2 id="查看微信卡包中的券详情"><a href="#查看微信卡包中的券详情" class="header-anchor">#</a> 查看微信卡包中的券详情</h2> <h4 id="jsapi接口"><a href="#jsapi接口" class="header-anchor">#</a> JsApi接口</h4> <ol><li>JS-SDK使用 <a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html" target="_blank" rel="noopener noreferrer">查看文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>打开券详情API</li></ol> <div class="language- extra-class"><pre class="language-text"><code>wx.openCard({
  cardId: result.stock_id ==&gt; &quot;string&quot;,
  code: result.coupon_code ==&gt; &quot;string&quot;,
  openCardParams: &quot;string&quot;
})
</code></pre></div><table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">变量名</th> <th style="text-align:center;">必填?</th> <th style="text-align:center;">说明</th> <th style="text-align:left;">映射此Api</th></tr></thead> <tbody><tr><td style="text-align:left;">批次号</td> <td style="text-align:left;">stock_id</td> <td style="text-align:center;">Y</td> <td style="text-align:center;">券的批次号</td> <td style="text-align:left;">cardId</td></tr> <tr><td style="text-align:left;">券code</td> <td style="text-align:left;">coupon_code</td> <td style="text-align:center;">Y</td> <td style="text-align:center;">券唯一标识id</td> <td style="text-align:left;">code</td></tr> <tr><td style="text-align:left;">打开参数</td> <td style="text-align:left;">open_params</td> <td style="text-align:center;">Y</td> <td style="text-align:center;">按如下规则生成</td> <td style="text-align:left;">openCardParams</td></tr></tbody></table> <h4 id="opencardparams生成方法"><a href="#opencardparams生成方法" class="header-anchor">#</a> openCardParams生成方法</h4> <ol><li><p>openCardParams参数格式: mch_id=商户号&amp;sign=将要生成的签名key</p></li> <li><p>签名方式: 对单张券信息进行签名, 即单张券信息参数平铺后, coupon_code, open_params, stock_id 按照参数名 ASCII 码从小到大排序(字典序), 使用 URL 键值对的格式(即key1=value1&amp;key2=value2…)拼接成字符串</p></li> <li><p>拼接秘钥 key, 用 api 秘钥进行 HMAC-SHA256 签名, 映射后得到最终的请求参数card_id, code 和 open_params, 详见<a href="https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=4_3" target="_blank" rel="noopener noreferrer">签名算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>举例:</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>[
  {
    coupon_code: '123456',
    stock_id: '654321',
    mch_id: '888888'
  },
  {
    coupon_code: '3456789',
    stock_id: '9876543',
    mch_id: '999999'
  }
]
</code></pre></div><ul><li>第一步 对参数按照 key=value 的格式, 并按照参数名 ASCII 字典序排序如下:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>第一张券: stringA=coupon_code=123456&amp;mch_id=888888&amp;stock_id=654321
第二张券: stringB=coupon_code=3456789&amp;mch_id=999999&amp;stock_id=9876543
</code></pre></div><ul><li>第二步 拼接API密钥 (<strong>注: HMAC-SHA256 签名方式</strong>)</li></ul> <div class="language- extra-class"><pre class="language-text"><code>第一张券: 
  stringtempA: stringA+'&amp;key=xxx' (key为 商户平台设置的密钥key)
  sign = hash_hmac('sha256', stringtempA, key).toUpperCase() = &quot;xxxxx&quot;
第二张券: 
  stringtempB: stringB+'&amp;key=xxx' (key为 商户平台设置的密钥key)
  sign = hash_hmac('sha256', stringtempB, key).toUpperCase() = &quot;xxxxx&quot;
</code></pre></div><ul><li>第三步 得到最终数据
<ul><li>stock_id 映射为 card_id</li> <li>coupon_code 映射为 code</li> <li>mch_id 和 sign 拼接在 openCardParams 中</li></ul> <div class="language- extra-class"><pre class="language-text"><code>[
  {
    cardId: stock_id,
    code: coupon_code,
    openCardParams: `mch_id=${发券商户号}&amp;sign=${sign}`
  }
]
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/StudyDocs/CLang/01_开始.html" class="prev">
        认识 C语言
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/StudyDocs/assets/js/app.f0167722.js" defer></script><script src="/StudyDocs/assets/js/2.90e59682.js" defer></script><script src="/StudyDocs/assets/js/9.3a5bd12d.js" defer></script>
  </body>
</html>
